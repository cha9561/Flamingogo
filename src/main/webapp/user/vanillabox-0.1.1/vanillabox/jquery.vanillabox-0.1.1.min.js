/*
 Vanillabox
 (C) 2013 cocopon.

 Licensed under the MIT license:
 http://www.opensource.org/licenses/mit-license.php
*/
(function(c){function f(a){if(!a.ba||0===a.ba.length)throw new u;this.L=!1;this.M=a.ba;this.k=e.h(a.r,t.S());this.kb=a.jb;this.pb=a.Za;this.G=a.Ra;this.Ta={B:a.B,A:a.A,type:a.type};this.j=new p({loop:a.loop,sb:this.M.length});this.create()}function v(a){this.s=a.o;this.create()}function q(a){this.s=a.o;this.R=e.h(a.disabled,!1);this.create()}function p(a){a=a||{};this.p=e.h(a.sb,1);this.F=e.h(a.loop,!1);this.za(e.h(a.page,0))}function l(a){a=a||{};this.ib=a.B;this.hb=a.A;k.call(this,a)}function n(a){k.call(this,
a)}function w(a){k.call(this,a)}function k(a){a=a||{};this.Ea=this.pa=!1;this.va=a.path;this.rb=e.h(a.title,"");this.create()}function r(a){this.e=new g({r:(a||{}).r});this.create();this.c()}function g(a){this.k=e.h((a||{}).r,t.S());this.create()}function s(){this.create()}function u(){}var m=c(window),e={N:function(){},Na:"vnbx",b:"vnbx-",n:"vnbx_",Ya:function(a){return void 0!==a},h:function(a,b){return e.Ya(a)?a:b},W:function(a,b){function d(){}d.prototype=b.prototype;a.prototype=new d},Ha:{forEach:function(a,
b,d){d=d||this;var c=a.length,e;for(e=0;e<c;e++)b.call(d,a[e],e)},map:function(a,b,d){d=d||this;var c=[],e=a.length,f;for(f=0;f<e;f++)c.push(b.call(d,a[f],f));return c}},Deferred:{t:function(){var a=new c.Deferred;setTimeout(function(){a.resolve()},0);return a.promise()}},D:{ia:function(){return window.innerWidth||document.documentElement.clientWidth},ha:function(){return window.innerHeight||document.documentElement.clientHeight}},ca:{na:function(){return!!navigator.userAgent.match(/(ipod|iphone|ipad)/ig)}}},
h={C:e.n+"change",m:e.n+"click",q:e.n+"complete",La:e.n+"hide",Ma:e.n+"load",Oa:e.n+"show"};u.yb={vb:"invalid_type",wb:"no_image"};var y,x;y={Da:function(a){return a.a.show()},ma:function(a){return a.a.hide()},Ca:function(a){y.$(a);return a.a.show()},la:function(a){return a.a.hide()},$:function(a){var b=a.e,d=b.l(),c=a.U(d);b.a.css({width:d.width,height:d.height});a.a.css({left:c.left,top:c.top});return e.Deferred.t()},Ba:function(a){return a.a.show()},ka:function(a){return a.a.hide()}};x={Da:function(a){return a.a.fadeIn(200)},
ma:function(a){return a.a.fadeOut(300)},Pa:function(a,b,d,e){var f=a.e.a;f.stop();b=f.animate({width:b.width,height:b.height},e);a=a.a;a.stop();d=a.animate({left:d.left,top:d.top},e);return c.when(b,d)},Ca:function(a){var b=a.e,d=b.l(),c=a.U(d);b.a.css({width:d.width,height:d.height});a.a.css({left:c.left,top:c.top});return e.Deferred.t()},la:function(){return e.Deferred.t()},$:function(a){var b=a.e.l(),d=a.U(b);return x.Pa(a,b,d,300)},Ba:function(a){return a.a.fadeIn(200)},ka:function(a){return a.a.fadeOut(300)}};
var t={Ga:{none:y,"default":x},get:function(a){return t.Ga[a]||t.S()},S:function(){return x}};s.prototype.create=function(){if(!this.a){var a=c("<div>");a.addClass(e.b+"mask");this.a=a;this.c()}};s.prototype.c=function(){m.on("resize",c.proxy(this.J,this));this.a.on("click",c.proxy(this.u,this))};s.prototype.i=function(){var a=this.a;a.width("");a.height("");var b=c(document),d=Math.max(b.width(),m.width()),b=Math.max(b.height(),m.height());a.width(d);a.height(b)};s.prototype.J=function(){this.i()};
s.prototype.u=function(){c(this).trigger(h.m)};g.Ia=100;g.ea=200;g.da=150;g.prototype.create=function(){if(!this.a){var a=c("<div>");a.addClass(e.b+"container");this.a=a;this.c()}};g.prototype.c=function(){};g.prototype.O=function(){c(this.d).on(h.q,c.proxy(this.w,this))};g.prototype.Q=function(){c(this.d).off(h.q,this.w)};g.prototype.lb=function(a){var b=this.k;this.d&&(this.Q(),b.ka(this.d));this.d=a;this.O();this.qa&&this.fa();a=this.a;var d=this.d.a,c=a.find("> *");0===c.length?a.append(d):d.insertBefore(c.first());
b.Ba(this.d)};g.prototype.l=function(){var a=this.d,b={width:0,height:0};a&&(b=a.l());return{width:Math.max(b.width,g.ea),height:Math.max(b.height,g.da)}};g.prototype.tb=function(){var a=g.Ia;this.qa={width:e.D.ia()-a,height:e.D.ha()-a};this.d&&this.fa()};g.prototype.fa=function(){var a=this.qa;this.d.aa(Math.max(a.width,g.ea),Math.max(a.height,g.da))};g.prototype.i=function(){var a=this.d,b=a.l();a.mb(-Math.round(b.width/2),-Math.round(b.height/2))};g.prototype.w=function(){this.i()};r.xb=500;r.prototype.create=
function(){if(!this.a){var a=c("<div>");a.addClass(e.b+"frame");this.a=a;this.a.append(this.e.a)}};r.prototype.c=function(){this.a.on("click",c.proxy(this.u,this))};r.prototype.U=function(a){var b=this.e.a,d=b.width(),c=b.height();b.width(a.width);b.height(a.height);a=this.a;var f=e.D.ia(),g=e.D.ha(),f=Math.round(m.scrollLeft()+(f-a.outerWidth())/2);a=Math.round(m.scrollTop()+(g-a.outerHeight())/2);b.width(d);b.height(c);return{left:f,top:a}};r.prototype.u=function(a){a.stopPropagation()};k.prototype.create=
function(){if(!this.a){var a=c("<div>");a.addClass(e.b+"content");this.a=a;this.P();this.c()}};k.prototype.P=e.N;k.prototype.c=e.N;k.prototype.l=function(){var a=this.a;return{width:a.width(),height:a.height()}};k.prototype.mb=function(a,b){this.a.css({marginLeft:a,marginTop:b})};k.prototype.aa=function(a,b){this.a.css({maxWidth:a,maxHeight:b})};k.prototype.load=function(){this.a.addClass(e.b+"loading");this.pa?this.v(this.Ea):this.X()};k.prototype.X=e.N;k.prototype.v=function(a){var b=this.a;this.pa=
!0;this.Ea=a;b.removeClass(e.b+"loading");a||b.addClass(e.b+"error");c(this).trigger(h.q,a)};e.W(w,k);w.prototype.create=function(){k.prototype.create.call(this);this.a.addClass(e.b+"empty")};w.prototype.load=function(){var a=this;setTimeout(function(){c(a).trigger(h.q,!0)},0)};e.W(n,k);n.prototype.P=function(){var a=c("<img>");this.a.append(a);this.V=a};n.prototype.c=function(){var a=this.V;a.on("load",c.proxy(this.Z,this));a.on("error",c.proxy(this.Y,this))};n.prototype.aa=function(a,b){this.V.css({maxWidth:a,
maxHeight:b})};n.prototype.X=function(){this.V.attr("src",this.va)};n.prototype.Z=function(){this.v(!0)};n.prototype.Y=function(){this.v(!1)};e.W(l,k);l.prototype.P=function(){var a=c("<iframe>");a.attr("frameborder",0);this.a.append(a);this.H=a};l.prototype.c=function(){var a=this.H;a.on("load",c.proxy(this.Z,this));a.on("error",c.proxy(this.Y,this))};l.prototype.T=function(){return e.ca.na()?this.a:this.H};l.prototype.l=function(){var a=this.T();return{width:a.width(),height:a.height()}};l.prototype.aa=
function(a,b){this.T().css({maxWidth:a,maxHeight:b})};l.prototype.X=function(){this.H.attr("src",this.va)};l.prototype.Z=function(){if(this.H.attr("src")){var a=this.T();a.width(this.ib);a.height(this.hb);this.v(!0)}};l.prototype.Y=function(){this.v(!1)};var z={Ka:{image:function(a){return new n({path:a.attr("href"),title:a.attr("title")})},iframe:function(a,b){return new l({path:a.attr("href"),B:b.B,A:b.A,title:a.attr("title")})}},create:function(a,b){var c=z.Ka[b.type];if(!c)throw new u;return c(a,
b)}};p.prototype.za=function(a){var b=this.f,d=this.p;this.f=a=Math.min(Math.max(a,0),d-1);b!==a&&c(this).trigger(h.C)};p.prototype.Xa=function(){return this.F?!0:0<this.f};p.prototype.ja=function(){return this.F?!0:this.f<this.p-1};p.prototype.next=function(){var a=this.p,b=this.f,d=b+1;d>a-1&&(d=this.F?0:a-1);this.f=d;b!==d&&c(this).trigger(h.C)};p.prototype.K=function(){var a=this.p,b=this.f,d=b-1;0>=d&&(d=this.F?a-1:0);this.f=d;b!==d&&c(this).trigger(h.C)};q.prototype.create=function(){if(!this.a){var a=
c("<div>");a.addClass(e.b+"button");this.s&&a.addClass(this.s);a.attr("ontouchstart","void(0)");this.a=a;this.c()}};q.prototype.c=function(){this.a.on("click",c.proxy(this.u,this))};q.prototype.ya=function(a){var b=this.a;(this.R=a)?b.addClass(e.b+"disabled"):b.removeClass(e.b+"disabled")};q.prototype.u=function(a){a.stopPropagation();this.R||c(this).trigger(h.m)};v.prototype.create=function(){if(!this.a){var a=c("<div>");a.addClass(e.b+"label");this.s&&a.addClass(this.s);this.a=a}};v.prototype.Aa=
function(a){this.a.text(a)};f.Ja=300;f.prototype.create=function(){var a=this;if(!a.Va){a.Va=!0;var b=new s,d=b.a;d.addClass(e.Na);d.hide();c("body").append(d);a.I=b;a.ob();var f=new r({r:a.k}),b=f.a;a.g=f;d.append(b);d=new v({o:e.b+"title"});a.qb=d;b.append(d.a);d=new v({o:e.b+"pager"});a.gb=d;b.append(d.a);d=new q({o:e.b+"prev"});a.wa=d;b.append(d.a);d=new q({o:e.b+"next"});a.ra=d;b.append(d.a);d=new q({o:e.b+"close"});a.G||d.a.hide();a.Sa=d;b.append(d.a);a.c();b=e.Ha.map(a.M,function(b){b=c(b);
return z.create(b,a.Ta)});a.Ua=b;b=new w;a.xa(b)}};f.prototype.ob=function(){var a=this.I.a;e.ca.na()&&a.addClass(e.b+"ios");this.G&&a.addClass(e.b+"close-button-enabled");1<this.j.p&&a.addClass(e.b+"group")};f.prototype.c=function(){this.M.on("click",c.proxy(this.fb,this));c(this.I).on(h.m,c.proxy(this.ab,this));c(this.j).on(h.C,c.proxy(this.cb,this));c(this.Sa).on(h.m,c.proxy(this.$a,this));c(this.wa).on(h.m,c.proxy(this.eb,this));c(this.ra).on(h.m,c.proxy(this.bb,this))};f.prototype.Qa=function(){var a=
c(document);m.on("resize",c.proxy(this.J,this));m.on("scroll",c.proxy(this.ua,this));a.on("keyup",c.proxy(this.ta,this))};f.prototype.Wa=function(){var a=c(document);m.off("resize",this.J,this);m.off("scroll",this.ua,this);a.off("keyup",this.ta,this)};f.prototype.O=function(){var a=this.g.e.d,b=a.a;c(a).on(h.q,c.proxy(this.w,this));b.on("click",c.proxy(this.sa,this))};f.prototype.Q=function(){var a=this.g.e.d,b=a.a;c(a).off("complete",this.w);b.off("click",this.sa)};f.prototype.show=function(a){var b=
this,d=b.k;if(b.L)return e.Deferred.t();b.L=!0;b.Qa();b.g.e.tb();var f=b.I;f.i();var f=d.Da(f),d=d.Ca(b.g),g=b.j;a=e.h(a,0);var k=a!==g.f;g.za(a);k||b.Fa();return c.when(f,d).then(function(){c(b).trigger(h.Oa)})};f.prototype.hide=function(){var a=this;return a.L?c.when(a.k.la(a.g),a.k.ma(a.I)).then(function(){a.Wa();a.L=!1;c(a).trigger(h.La)}):e.Deferred.t()};f.prototype.nb=function(a){this.qb.Aa(a)};f.prototype.K=function(){this.j.K()};f.prototype.next=function(){this.j.next()};f.prototype.xa=function(a){var b=
this.g.e,c=this.g.e.d;c!==a&&(c&&this.Q(),b.lb(a),this.O(),this.nb(a.rb),a.load());b.i()};f.prototype.i=function(a){(a||this.kb)&&this.k.$(this.g)};f.prototype.ub=function(){var a=this.j;this.gb.Aa(String(a.f+1)+" of "+String(a.p));this.wa.ya(!a.Xa());this.ra.ya(!a.ja())};f.prototype.Fa=function(){this.ub();this.xa(this.Ua[this.j.f])};f.prototype.ga=function(){var a=this;a.oa&&clearTimeout(a.oa);a.oa=setTimeout(function(){a.i(!1)},f.Ja)};f.prototype.J=function(){this.ga()};f.prototype.ua=function(){this.ga()};
f.prototype.ta=function(a){if(this.pb)switch(a.keyCode){case 27:this.hide();break;case 37:this.K();break;case 39:this.next()}};f.prototype.fb=function(a){var b=this.M.index(a.delegateTarget);0>b||(a.preventDefault(),this.show(b))};f.prototype.cb=function(){this.Fa()};f.prototype.ab=function(){this.G||this.hide()};f.prototype.$a=function(){this.G&&this.hide()};f.prototype.eb=function(){this.K()};f.prototype.bb=function(){this.next()};f.prototype.w=function(a,b){this.i(!0);c(this).trigger(h.Ma,b)};
f.prototype.sa=function(a){var b=this.j;a.stopPropagation();b.ja()?this.next():this.hide()};var A={animation:"default",closeButton:!1,keyboard:!0,loop:!1,preferredHeight:600,preferredWidth:800,repositionOnScroll:!1,type:"image"};c.fn.vanillabox=function(a){var b={};c.extend(b,A);c.extend(b,a);a=c(this);var d=t.get(b.animation);return new f({r:d,Ra:b.closeButton,Za:b.keyboard,loop:b.loop,A:b.preferredHeight,B:b.preferredWidth,jb:b.repositionOnScroll,ba:a,type:b.type})};c.fn.vanillabox.zb={Events:h,
DEFAULT_CONFIG:A,Pager:p,Util:e,Vanillabox:f,VanillaException:u}})(jQuery);
